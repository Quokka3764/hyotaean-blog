---
title: 'ë¸”ë¡œê·¸ ì œì‘ê¸° - ì´ë¯¸ì§€ ê´€ë¦¬í•˜ê¸°'
date: '2025-04-16 21:17'
thumbnail: 'nextJs.avif'
tags: ["Next.js", "ë¸”ë¡œê·¸ ì œì‘ê¸°", "ì´ë¯¸ì§€ ê´€ë¦¬"]
excerpt: 'ë¸”ë¡œê·¸ ê´€ë¦¬ì—ì„œ ì¤‘ìš”í•œ ì´ë¯¸ì§€ ê´€ë¦¬ë¥¼ ì–´ë–»ê²Œ í•˜ê³  ìˆëŠ”ì§€ ì„¤ëª…í•©ë‹ˆë‹¤'
---

# ì´ë¯¸ì§€ë¥¼ ê´€ë¦¬ì— ëŒ€í•œ ê³ ì°°

ë¸”ë¡œê·¸ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë¼ë©´ ê°€ì¥ ê³¨ì¹˜ì•„í”ˆ ë¶€ë¶„ì´ ì´ë¯¸ì§€ ê´€ë¦¬ì¼ ê²ƒì´ë¼ê³  í™•ì‹ í•œë‹¤. ë‚˜ë§Œì˜ ì‘ì€ ë¸”ë¡œê·¸ ì¼ ë¿ì´ì§€ë§Œ, ì¥ê¸°ì ì¸ ê´€ì ìœ¼ë¡œ ë³´ì•˜ì„ ë•Œ ì´ë¯¸ì§€ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ì²´ê³„ë¥¼ ë§Œë“œëŠ” ê²ƒì€ í•„ìˆ˜ì˜€ë‹¤. ìš©ëŸ‰ì´ í° ì´ë¯¸ì§€, ì‚¬ì´ì¦ˆê°€ ë‹¤ë¥¸ ì´ë¯¸ì§€ ë“¤ì„ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ê²ƒì¸ì§€ ì•„ì§ë„ ë‚œê°í•˜ê²Œë§Œ ëŠê»´ì§„ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ **ì‘ì€ ì‚¬ì´ì¦ˆì˜ ì´ë¯¸ì§€**ë¥¼ ë³¸ë¬¸ì— ë„£ì—ˆì„ ë•Œ, ì´ë¯¸ì§€ë¥¼ ì–µì§€ë¡œ ë¸”ë¡œê·¸ì˜ ì‚¬ì´ì¦ˆì— ë§ì¶°ì„œ ëŠ˜ë¦¬ê²Œ ë˜ë©´ ì´ë¯¸ì§€ê°€ ê¹¨ì§€ë©´ì„œ ê°€ë…ì„±ì´ ì €í•´ëœë‹¤.  ì´ê±¸ ë‹¨ìˆœí•˜ê²Œ í¬ìŠ¤íŒ…í•œ ìœ ì € í˜¹ì€ ë‚´ê°€ ì ì ˆí•œ ì´ë¯¸ì§€ë¥¼ ê³ ë¥´ëŠ”ê²Œ ë§ëŠ”ê±´ì§€ ì•„ë‹ˆë©´ í´ë¼ì´ì–¸íŠ¸ë‹¨ì—ì„œ ì²˜ë¦¬í•´ì¤„ ë°©ë²•ì´ ì—†ëŠ”ì§€ ì—¬ì „íˆ ê³ ë¯¼ì´ ë˜ê³  ìˆë‹¤. ì—¬ëŸ¬ ë¸”ë¡œê·¸ ì„œë¹„ìŠ¤ë¥¼ ì°¸ê³ í•´ ë³´ë©´ ìœ ì €ê°€ ì ì ˆí•œ ì´ë¯¸ì§€ë¥¼ ê³ ë¥´ê²Œ í•˜ëŠ” ê²ƒì´ ë§ëŠ” ê²ƒìœ¼ë¡œ ë³´ì´ì§€ë§Œ, í˜¹ì‹œë‚˜ ë‹¤ë¥¸ ë°©ë²•ì´ ì—†ë‚˜ ê³ ë¯¼ ì¤‘ì´ë‹¤.

**ìš©ëŸ‰ì´ í° ì´ë¯¸ì§€**ë„ ë¬¸ì œë‹¤. íŠ¹íˆë‚˜ ì‘ì€ ê·œëª¨ì˜ ë¸”ë¡œê·¸ë¡œì¨ëŠ” ì¹˜ëª…ì ì´ì—ˆë‹¤. ëŒ€ëµ 20MBê°€ ë„˜ì–´ê°€ë©´ ì‚¬ì‹¤ìƒ ìµœì•…ì— ê°€ê¹Œìš´ ë Œë”ë§ ì†ë„ê°€ ë‚˜ì˜¨ë‹¤. ë¼ì´íŠ¸í•˜ìš°ìŠ¤ì˜ ì ìˆ˜ë„ 80~90ì ëŒ€ë¥¼ ì›ƒëŒë‹¤ê°€ 20ì ëŒ€ë¡œ í™• ë–¨ì–´ì§„ë‹¤. ê°ê´€ì ì¸ ì§€í‘œì ìˆ˜ë„ ë–¨ì–´ì§€ê³  UXë„ ë–¨ì–´ì§€ëŠ” ì´ í˜„ìƒì„ ì–´ë–»ê²Œ í•´ì•¼ ìµœì í™”ë¥¼ í•  ìˆ˜ ìˆì„ì§€ ê³ ë¯¼ì´ë‹¤. ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ í˜ì´ì§€ë¥¼ ë Œë”ë§ í•˜ë‹¤ë³´ë‹ˆ `img`íƒœê·¸ë¡œ ì „í™˜ì´ ë˜ì–´ì„œ Nextì—ì„œ ì§€ì›í•˜ëŠ” Image ìµœì í™” ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸°ê°€ ì–´ë ¤ìš´ë° ì–´ë–»ê²Œ í•´ì•¼ ëŒ€ì²´í•  ìˆ˜ ìˆì„ì§€ ë‹¤ìŒí¸ì—ì„œ ì„œìˆ í•´ë³´ë ¤ê³  í•œë‹¤. í˜¹ì€, ì´ ë°©ë²•ì´ ë³„ë¡œ íš¨ê³¼ì ì´ì§€ ëª»í•˜ë‹¤ë©´ ë‹¤ë¥¸ ë¼ì´ë²„ë¦¬ì˜ í™œìš©ì„ ê³ ë¯¼í•´ë´ì•¼ í•  ê²ƒ ê°™ë‹¤.

# ì´ë¯¸ì§€ ì €ì¥ë°©ì‹ì€ ìºì‹± & ì¤‘ë³µì €ì¥ ë°©ì§€

ì´ê±¸ êµ¬í˜„í•˜ê²Œ ëœ ê²ƒë„ ë¸”ë¡œê·¸ì˜ ê¸€ì„ ê³„ì† ì“°ë‹¤ë³´ë‹ˆ ê¹¨ë‹«ê²Œ ëœ ì‚¬ì‹¤ì´ë‹¤. ì¬ì‚¬ìš©ëœ ì´ë¯¸ì§€ê°€ ê³„ì†í•´ì„œ ì¤‘ë³µìœ¼ë¡œ ì €ì¥ë˜ì–´ì ¸ ì™”ê³  ì´ì™€ ê´€ë ¨ëœ ëŒ€ì±…ì´ ì „í˜€ ì—†ì—ˆë˜ ê²ƒì´ë‹¤. ê·¸ë˜ì„œ ì•„ì§ ì´ë¯¸ì§€ ìµœì í™”ëŠ” ëœ ë˜ì—ˆì§€ë§Œ ì €ì¥ ë° ê´€ë¦¬ ë°©ì‹ì€ ê¸‰í•˜ë‹¤ê³  íŒë‹¨ì´ ë¼ì„œ ë‚˜ë¦„ì˜ ë°©ì‹ì„ êµ¬í˜„í•´ ë³´ì•˜ë‹¤.

## 1. ì´ë¯¸ì§€ ì €ì¥ ë°©ì‹

í˜„ì¬ ë¸”ë¡œê·¸ì˜ ì´ë¯¸ì§€ ì €ì¥ ë°©ì‹ì€ Supabase Storageì— ì €ì¥í•˜ë„ë¡ êµ¬ì¶•ë˜ì–´ ìˆë‹¤.
- blog-images ë¼ëŠ” ë²„í‚·ì— ì €ì¥
- ë¸”ë¡œê·¸ì— ì‚¬ìš©ë˜ì—ˆë˜ ì´ë¯¸ì§€ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ì„œ ë‚ ì§œë³„ í´ë”ë¥¼ í˜•ì„±
- ì´ë¯¸ì§€ë¥¼ í•´ì‹œ ê¸°ë°˜ íŒŒì¼ëª…ìœ¼ë¡œ ì €ì¥í•´ì„œ ì¤‘ë³µ ë°©ì§€
- í•´ì‹œ ê¸°ë°˜ ìºì‹±ìœ¼ë¡œ ì¤‘ë³µ ì—…ë¡œë“œë¥¼ ìµœì†Œí™”

> uploadImageToStorage

```typescript
// ë‹¨ì¼ ì´ë¯¸ì§€ë¥¼ Supabase Storageì— ì—…ë¡œë“œ
export async function uploadImageToStorage(
  originalPath: string,
  imageBuffer: Buffer,
  folder: string,
  supabase: SupabaseClient<Database>,
  bucket: string = "blog-images"
): Promise<string | null> {
  try {
    // íŒŒì¼ í•´ì‹œ ìƒì„±
    const fileHash = generateFileHash(imageBuffer).substring(0, 16);
    const cacheKey = fileHash;

    // ìºì‹œ í™•ì¸
    if (hasInCache(cacheKey)) {
      const cachedUrl = getFromCache(cacheKey);
      console.log(`ìºì‹œì—ì„œ ì´ë¯¸ì§€ URL ì‚¬ìš©: ${cachedUrl}`);
      return cachedUrl || null;
    }

    // íŒŒì¼ëª… ìƒì„± (í•´ì‹œ ê¸°ë°˜ìœ¼ë¡œ ì¤‘ë³µ ë°©ì§€)
    const fileExt = path.extname(originalPath).toLowerCase();
    const fileName = `${folder}/${fileHash}${fileExt}`.replace(/^\//, "");

    console.log(`ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹œë„: ${fileName} (í•´ì‹œ: ${fileHash})`);

    // Supabase Storageì— ì—…ë¡œë“œ (ì¬ì‹œë„ ë¡œì§ í¬í•¨)
    await retry(
      async () => {
        const { error } = await supabase.storage
          .from(bucket)
          .upload(fileName, imageBuffer, {
            contentType: getMimeType(originalPath),
            cacheControl: "3600",
            upsert: true, // ê°™ì€ ê²½ë¡œë©´ ë®ì–´ì“°ê¸°
          });

        if (error) throw error;
      },
      `ì´ë¯¸ì§€ ì—…ë¡œë“œ (${originalPath})`,
      3,
      1000
    );

    // ê³µê°œ URL ê°€ì ¸ì˜¤ê¸°
    const { data: urlData } = supabase.storage
      .from(bucket)
      .getPublicUrl(fileName);

    const publicUrl = transformStorageUrl(urlData.publicUrl);

    // ìºì‹œì— ì €ì¥
    addToCache(cacheKey, publicUrl);

    console.log(`ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ: ${originalPath} -> ${publicUrl}`);
    return publicUrl;
  } catch (error) {
    console.error(`ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨ (${originalPath}):`, error);
    return null;
  }
}
```

## 2. ì´ë¯¸ì§€ ì²˜ë¦¬ ì›Œí¬ í”Œë¡œìš°

ë§ˆí¬ë‹¤ìš´ ë‚´ ì´ë¯¸ì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
- ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ë‚´ì˜ ì´ë¯¸ì§€ ì‚½ì… íŒ¨í„´ìœ¼ë¡œ ì´ë¯¸ì§€ ì¸ì‹
- ë¡œì»¬ ê²½ë¡œ í™•ì¸ ë° ì´ë¯¸ì§€ íŒŒì¼ ì½ê¸°
- ì´ë¯¸ì§€ í•´ì‹œ ìƒì„± ë° ì¤‘ë³µ í™•ì¸
- Supabase Storageì— ì—…ë¡œë“œ
- ë§ˆí¬ë‹¤ìš´ ë‚´ ì´ë¯¸ì§€ URLì„ Supabase URLë¡œ êµì²´

> uploadContentImages

```typescript
// ë§ˆí¬ë‹¤ìš´ ì½˜í…ì¸ ì˜ ì´ë¯¸ì§€ë¥¼ ë‚ ì§œ í´ë” êµ¬ì¡°ë¡œ ì—…ë¡œë“œ
export async function uploadContentImages(
  markdownContent: string,
  filePath: string,
  postDate: string,
  supabase: SupabaseClient<Database>,
  bucket: string = "blog-images"
): Promise<string> {
  const imageRegex = /!\[(.*?)\]\((.*?)\)/g;
  let processedContent = markdownContent;
  const matches = [...markdownContent.matchAll(imageRegex)];

  if (matches.length === 0) return markdownContent;

  console.log(`ë§ˆí¬ë‹¤ìš´ì—ì„œ ì´ë¯¸ì§€ ${matches.length}ê°œ ë°œê²¬`);

  // ë‚ ì§œ ê¸°ë°˜ í´ë” ìƒì„±
  const dateFolder = formatDateFolder(postDate);

  // ë™ì‹œì„± ì œí•œì„ ìœ„í•œ ë°°ì¹˜ ì²˜ë¦¬ (í•œ ë²ˆì— ìµœëŒ€ 5ê°œ ì´ë¯¸ì§€ ì²˜ë¦¬)
  const BATCH_SIZE = 5;
  for (let i = 0; i < matches.length; i += BATCH_SIZE) {
    const batch = matches.slice(i, i + BATCH_SIZE);

    // í˜„ì¬ ë°°ì¹˜ ë‚´ ì´ë¯¸ì§€ ë³‘ë ¬ ì²˜ë¦¬
    const results = await Promise.all(
      batch.map(async (match) => {
        const [fullMatch, altText, imagePath] = match;

        // ì´ë¯¸ ì™¸ë¶€ URLì´ê±°ë‚˜ Supabase URLì¸ ê²½ìš° ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
        if (isExternalUrl(imagePath) || isSupabaseStorageUrl(imagePath)) {
          console.log(`ì´ë¯¸ ì²˜ë¦¬ëœ ì´ë¯¸ì§€ URL ìœ ì§€: ${imagePath}`);
          return { fullMatch, newUrl: imagePath, altText };
        }

        try {
          // ì‹¤ì œ íŒŒì¼ ê²½ë¡œ ê³„ì‚° ë° íŒŒì¼ ì½ê¸°
          const fullImagePath = resolveLocalImagePath(filePath, imagePath);
          await fs.access(fullImagePath);
          const imageBuffer = await fs.readFile(fullImagePath);

          // í´ë” êµ¬ì¡° ì¶”ì¶œ (ë‚ ì§œ + ì›ë³¸ ê²½ë¡œ)
          const originalFolder = path.dirname(imagePath).replace(/^\.\//, "");
          const folderPath = originalFolder
            ? `${dateFolder}/${originalFolder}`
            : dateFolder;

          // ì´ë¯¸ì§€ ì—…ë¡œë“œ
          const publicUrl = await uploadImageToStorage(
            imagePath,
            imageBuffer,
            folderPath,
            supabase,
            bucket
          );

          if (publicUrl) {
            console.log(`ì´ë¯¸ì§€ ì²˜ë¦¬ ì„±ê³µ: ${imagePath} -> ${publicUrl}`);
            return { fullMatch, newUrl: publicUrl, altText };
          }
        } catch (error) {
          console.error(`ì´ë¯¸ì§€ ì²˜ë¦¬ ì‹¤íŒ¨ (${imagePath}):`, error);
        }

        return { fullMatch, newUrl: imagePath, altText };
      })
    );

    // ì²˜ë¦¬ëœ ì´ë¯¸ì§€ URLë¡œ ë§ˆí¬ë‹¤ìš´ ì—…ë°ì´íŠ¸
    for (const { fullMatch, newUrl, altText } of results) {
      processedContent = processedContent.replace(
        fullMatch,
        `![${altText}](${newUrl})`
      );
    }
  }

  return processedContent;
}
```

## 3. ì¸ë„¤ì¼ ì´ë¯¸ì§€ ì²˜ë¦¬

ì¸ë„¤ì¼ ì´ë¯¸ì§€ëŠ” ë³¸ë¬¸ì— ì‚¬ìš©ë˜ëŠ” ì´ë¯¸ì§€ì™€ ë³„ë„ë¡œ ê´€ë¦¬í•œë‹¤.
- ê¸°ì¡´ ì¸ë„¤ì¼ê³¼ì˜ í•´ì‹œ ë¹„êµë¡œ ë³€ê²½ ì—¬ë¶€ í™•ì¸
- ì¸ë„¤ì¼ì´ ë³€ê²½ëœ ê²½ìš° ê¸°ì¡´ ì¸ë„¤ì¼ ì‚­ì œ(Storage)
- ìƒˆë¡œìš´ ì¸ë„¤ì¼ì„ thumbnails í´ë”ì— ì—…ë¡œë“œ
- ì—…ë¡œë“œëœ ì¸ë„¤ì¼ URL ë°˜í™˜

> uploadThumbnail

```typescript
// ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ Supabase Storageì— ì—…ë¡œë“œ
export async function uploadThumbnail(
  thumbnailPath: string,
  basePath: string,
  supabase: SupabaseClient<Database>,
  oldThumbnailUrl: string | null = null,
  bucket: string = "blog-images"
): Promise<string | null> {
  if (!thumbnailPath) return null;

  console.log(`ì¸ë„¤ì¼ ì²˜ë¦¬ ì‹œì‘: ${thumbnailPath}`);

  // ì´ë¯¸ Supabase URLì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  if (isSupabaseStorageUrl(thumbnailPath)) {
    console.log(`ì´ë¯¸ Supabase URLì¸ ì¸ë„¤ì¼ ìœ ì§€: ${thumbnailPath}`);
    return thumbnailPath;
  }

  // ì™¸ë¶€ URLì´ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©
  if (isExternalUrl(thumbnailPath)) {
    console.log(`ì™¸ë¶€ URL ì¸ë„¤ì¼ ìœ ì§€: ${thumbnailPath}`);
    return thumbnailPath;
  }

  // ë¡œì»¬ íŒŒì¼ ê²½ë¡œì¸ ê²½ìš°ì—ë§Œ ì²˜ë¦¬
  try {
    // ì‹¤ì œ íŒŒì¼ ê²½ë¡œ ê³„ì‚° ë° íŒŒì¼ ì½ê¸°
    const fullImagePath = resolveLocalImagePath(basePath, thumbnailPath);
    await fs.access(fullImagePath);
    const imageBuffer = await fs.readFile(fullImagePath);

    // ì´ë¯¸ì§€ í•´ì‹œ ê³„ì‚°
    const newImageHash = generateFileHash(imageBuffer).substring(0, 16);

    // ê¸°ì¡´ URLì´ ìˆê³  ê°™ì€ ì´ë¯¸ì§€ì¸ì§€ í™•ì¸
    if (oldThumbnailUrl && isSupabaseStorageUrl(oldThumbnailUrl)) {
      // URLì— í•´ì‹œê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
      if (oldThumbnailUrl.includes(newImageHash)) {
        console.log("ë™ì¼í•œ ì¸ë„¤ì¼ ì´ë¯¸ì§€ ê°ì§€: ê¸°ì¡´ URL ìœ ì§€");
        return oldThumbnailUrl;
      }

      // ì´ë¯¸ì§€ê°€ ë³€ê²½ëœ ê²½ìš° ê¸°ì¡´ ì´ë¯¸ì§€ ì‚­ì œ
      console.log(
        "ì¸ë„¤ì¼ ì´ë¯¸ì§€ ë³€ê²½ ê°ì§€: ì´ì „ ì´ë¯¸ì§€ ì‚­ì œ í›„ ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ"
      );
      await deleteOldThumbnail(oldThumbnailUrl, supabase, bucket);
    }

    // ìƒˆ ì´ë¯¸ì§€ ì—…ë¡œë“œ
    const folderPath = "thumbnails";
    return await uploadImageToStorage(
      thumbnailPath,
      imageBuffer,
      folderPath,
      supabase,
      bucket
    );
  } catch (error) {
    console.error(`ì¸ë„¤ì¼ ì²˜ë¦¬ ì‹¤íŒ¨ (${thumbnailPath}):`, error);
    return null;
  }
}
```

## 4. ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì²˜ë¦¬

ë³¸ë¬¸ ë‚´ì˜ ì´ë¯¸ì§€ê°€ ìˆ˜ì •ë˜ì–´ì„œ ë” ì´ìƒ ì‚¬ìš©ë˜ê³  ìˆì§€ ì•Šë‹¤ë©´ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ë„ë¡ ë¡œì§ì„ êµ¬ì„±í–ˆë‹¤.
- ê¸°ì¡´ ë§ˆí¬ë‹¤ìš´ê³¼ ìƒˆ ë§ˆí¬ë‹¤ìš´ì—ì„œ ì´ë¯¸ì§€ URL ì¶”ì¶œ
- ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” URL ëª©ë¡ ìƒì„±
- í•´ë‹¹ ì´ë¯¸ì§€ë“¤ì„ Supabase Storageì—ì„œ ì‚­ì œ

> cleanupUnusedImages, deleteImagesByUrls 

```typescript
// ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì •ë¦¬
export async function cleanupUnusedImages(
  oldContent: string | null,
  newContent: string,
  supabase: SupabaseClient<Database>,
  bucket: string = "blog-images"
): Promise<void> {
  // ê¸°ì¡´ ì´ë¯¸ì§€ URL ì¶”ì¶œ
  const oldImageUrls = oldContent ? extractSbImgUrls(oldContent) : [];

  if (oldImageUrls.length === 0) return;

  // ìƒˆ ì½˜í…ì¸ ì—ì„œ ì´ë¯¸ì§€ URL ì¶”ì¶œ
  const newImageUrls = extractSbImgUrls(newContent);

  // ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì°¾ê¸°
  const unusedImageUrls = oldImageUrls.filter(
    (oldUrl) => !newImageUrls.includes(oldUrl)
  );

  if (unusedImageUrls.length === 0) return;

  await deleteImagesByUrls(unusedImageUrls, supabase, bucket);
}


// URL ëª©ë¡ìœ¼ë¡œ ì´ë¯¸ì§€ ì‚­ì œ
export async function deleteImagesByUrls(
  imageUrls: string[],
  supabase: SupabaseClient<Database>,
  bucket: string = "blog-images"
): Promise<boolean> {
  try {
    console.log(`ì‚­ì œí•  ì´ë¯¸ì§€: ${imageUrls.length}ê°œ`);

    // ìŠ¤í† ë¦¬ì§€ ê²½ë¡œ ì¶”ì¶œ
    const storagePaths = imageUrls
      .map((url) => extractStoragePath(url, bucket))
      .filter(Boolean) as string[];

    if (storagePaths.length === 0) return true;

    // ì´ë¯¸ì§€ ì‚­ì œ
    await retry(
      async () => {
        const { error } = await supabase.storage
          .from(bucket)
          .remove(storagePaths);

        if (error) throw error;
      },
      `ì´ë¯¸ì§€ ì‚­ì œ (${storagePaths.length}ê°œ)`,
      3,
      1000
    );

    console.log(`ì´ë¯¸ì§€ ${storagePaths.length}ê°œ ì‚­ì œ ì™„ë£Œ`);
    return true;
  } catch (error) {
    console.error("ì´ë¯¸ì§€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
    return false;
  }
}
```

## 5. ì˜¤ë¥˜ ì²˜ë¦¬ ë° ì¬ì‹œë„ ì„¤ì •

CI íŒŒì´í”„ë¼ì¸ì—ì„œ ê°€ë” ì´ë¯¸ì§€ ì—…ë¡œë“œë‚˜ ì‚­ì œë¥¼ í•  ë•Œ, ì‹¤íŒ¨ë¥¼ í•˜ëŠ” ê²½ìš°ê°€ ìˆì—ˆë‹¤. ì•„ë§ˆë„ ì¼ì‹œì  ì˜¤ë¥˜ë‚˜ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì¼ ê°€ëŠ¥ì„±ìœ¼ë¡œ íŒë‹¨ë¼ì„œ ë³„ë„ì˜ retryí•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ì•ˆì •ì ìœ¼ë¡œ ì—…ë¡œë“œë¥¼ ì‹œë„í•˜ë„ë¡ í•˜ê³ , ë””ë²„ê¹… ë¡œê·¸ë¥¼ ë‚¨ê¸°ê²Œ í•´ì„œ ì›ì¸ì„ ì•Œ ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆë‹¤.

- ìµœëŒ€ 3íšŒ ì¬ì‹œë„ ì„¤ì •, ì‹¤íŒ¨ì‹œ ë°˜ë³µ ì‹œë„
- ê° íšŸìˆ˜ ì‚¬ì´ì— ëŒ€ê¸°ì‹œê°„ ì ìš© (1000ms)
- ì‹¤íŒ¨ì‹œ ì›ì¸ê³¼ ë‚¨ì€ ì¬ì‹œë„ íšŸìˆ˜ í‘œê¸°
- ëª¨ë“  ì¬ì‹œë„ê°€ ì‹¤íŒ¨í•˜ë©´ ìµœì¢… ì˜¤ë¥˜ ë°œìƒ

> retry

```typescript
export async function retry<T>(
  fn: () => Promise<T>,
  description = "Operation",
  retries = 3,
  delayMs = 1000
): Promise<T> {
  let attempt = 0;
  while (attempt <= retries) {
    try {
      return await fn();
    } catch (error) {
      if (attempt === retries) {
        throw error;
      }
      console.warn(
        `${description} ì‹¤íŒ¨, ì¬ì‹œë„ ì¤‘... (${retries - attempt}íšŒ ë‚¨ìŒ)`
      );
      await sleep(delayMs);
      attempt++;
    }
  }
  // ì´ ì½”ë“œëŠ” ë„ë‹¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
  throw new Error("retry: unexpected error");
}
```


# ê²°ë¡ 

ê²°ë¡ ì ìœ¼ë¡œ, ì´ë¯¸ì§€ ê´€ë¦¬ ì‹œìŠ¤í…œì€ ë‚˜ë¦„ëŒ€ë¡œ ì²´ê³„ì ìœ¼ë¡œ êµ¬í˜„í–ˆë‹¤ê³  ìƒê°í•œë‹¤. Supabase Storageë¥¼ í™œìš©í•´ í´ë¼ìš°ë“œì— ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ê³ , í•´ì‹œ ê¸°ë°˜ìœ¼ë¡œ íŒŒì¼ëª…ì„ ê´€ë¦¬í•˜ë©°, ìºì‹± ì‹œìŠ¤í…œìœ¼ë¡œ ì¤‘ë³µ ì—…ë¡œë“œë¥¼ ë°©ì§€í•˜ê³  ìˆë‹¤. íŠ¹íˆ ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ ì •ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì€ ë¸”ë¡œê·¸ ê´€ë¦¬ ì¸¡ë©´ì—ì„œ ê½¤ ë§Œì¡±ìŠ¤ëŸ½ë‹¤.

í•˜ì§€ë§Œ ì—¬ì „íˆ ì•„ì‰¬ìš´ ì ì´ ìˆë‹¤. ì¸ë„¤ì¼ ì´ë¯¸ì§€ëŠ” Next.jsì˜ `<Image>` ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ ìµœì í™”ë˜ì–´ ìˆì§€ë§Œ, ë§ˆí¬ë‹¤ìš´ ë³¸ë¬¸ ë‚´ ì´ë¯¸ì§€ëŠ” ì•„ì§ ê·¸ë ‡ì§€ ëª»í•˜ë‹¤. ì„œë¡ ì—ì„œ ì–¸ê¸‰í–ˆë˜ ê²ƒì²˜ëŸ¼ ìš©ëŸ‰ì´ í° ì´ë¯¸ì§€ì™€ ì‚¬ì´ì¦ˆê°€ ë‹¤ë¥¸ ì´ë¯¸ì§€ë“¤ì˜ ë¬¸ì œëŠ” ì—¬ì „íˆ í•´ê²°í•´ì•¼ í•  ê³¼ì œë¡œ ë‚¨ì•„ìˆë‹¤.

ë‹¤ìŒ ê¸€ì—ì„œëŠ” ë§ˆí¬ë‹¤ìš´ ë‚´ ì´ë¯¸ì§€ë¥¼ Next.jsì˜ `<Image>` ì»´í¬ë„ŒíŠ¸ë¡œ ëŒ€ì²´í•˜ëŠ” ë°©ë²•ì„ ëª¨ìƒ‰í•´ë³´ê±°ë‚˜, ì´ ë°©ë²•ì´ íš¨ê³¼ì ì´ì§€ ì•Šë‹¤ë©´ ë‹¤ë¥¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ í™œìš©ë„ ê²€í† í•´ë³´ë ¤ í•œë‹¤. ê¶ê·¹ì ì¸ ëª©í‘œëŠ” ì´ë¯¸ì§€ë¡œ ì¸í•œ ì„±ëŠ¥ ì €í•˜ ì—†ì´ ê¹”ë”í•œ ë¸”ë¡œê·¸ ìš´ì˜ì„ í•˜ëŠ” ê²ƒì´ë‹ˆê¹Œ!!! ğŸ”¥